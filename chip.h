#ifndef CHIP_8
#define CHIP_8

#include <stdbool.h>
#include <stdio.h>
#include <SDL2/SDL.h>
#include <stdlib.h>
	
#define RESIZE_FACTOR 10
#define SCREEN_HEIGHT 320
#define SCREEN_WIDTH 640
#define BPP 4
#define SCREEN_DEPTH 10

unsigned char memory[4096];//4kb memory
unsigned char v[16];//registers
unsigned short i;//instruction
unsigned short pc;//program counter

unsigned short stack[16];//stack
unsigned short sp;//stack pointer

int delay_timer;
int sound_timer;

unsigned char keys[16];

unsigned char display[SCREEN_HEIGHT * SCREEN_WIDTH];

bool needsRedraw;


SDL_Window * window;
SDL_Renderer * renderer;
SDL_Texture * texture;

void chip_init();
void chip_run();
void chip_load_file(char * file);

void removeDrawFlag();


int display_init();
int display_clear();
int display_draw(int x, int y, int c);
void display_setpx(int x, int y, unsigned char r, unsigned char g, unsigned char b);
int display_update();


static const unsigned char fontset[5*16] = {
	0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
	0x20, 0x60, 0x20, 0x20, 0x70, // 1
	0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
	0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
	0x90, 0x90, 0xF0, 0x10, 0x10, // 4
	0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
	0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
	0xF0, 0x10, 0x20, 0x40, 0x40, // 7
	0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
	0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
	0xF0, 0x90, 0xF0, 0x90, 0x90, // A
	0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
	0xF0, 0x80, 0x80, 0x80, 0xF0, // C
	0xE0, 0x90, 0x90, 0x90, 0xE0, // D
	0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
	0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

void chip_load_fontset();

#endif
